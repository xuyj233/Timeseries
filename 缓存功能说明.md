# æœ¬åœ°ç¼“å­˜åŠŸèƒ½è¯´æ˜

## é—®é¢˜

ä¹‹å‰çš„å®ç°æ¯æ¬¡è¿è¡Œè®­ç»ƒæ—¶éƒ½ä¼šï¼š
1. ä»HuggingFaceä¸‹è½½UTSDæ•°æ®é›†ï¼ˆè™½ç„¶æœ‰é•œåƒç¼“å­˜ï¼Œä½†ä»éœ€ç½‘ç»œè¯·æ±‚ï¼‰
2. é‡æ–°å¤„ç†68679ä¸ªæ ·æœ¬ï¼Œæå–åºåˆ—å¹¶å½’ä¸€åŒ–
3. è¿™ä¸ªè¿‡ç¨‹è€—æ—¶è¾ƒé•¿ï¼Œç‰¹åˆ«æ˜¯åœ¨ç½‘ç»œä¸ç¨³å®šæ—¶

## è§£å†³æ–¹æ¡ˆ

ç°åœ¨å®ç°äº†**æœ¬åœ°ç¼“å­˜**åŠŸèƒ½ï¼š

### 1. è‡ªåŠ¨ç¼“å­˜

ç¬¬ä¸€æ¬¡è¿è¡Œæ—¶ï¼Œå¤„ç†åçš„æ•°æ®ä¼šè‡ªåŠ¨ä¿å­˜åˆ°æœ¬åœ°ï¼š
```
data_cache/
â”œâ”€â”€ train_sequences.pkl  # è®­ç»ƒåºåˆ—ï¼ˆå·²å¤„ç†ã€å·²å½’ä¸€åŒ–ï¼‰
â”œâ”€â”€ val_sequences.pkl    # éªŒè¯åºåˆ—
â””â”€â”€ data_config.pkl      # æ•°æ®é…ç½®
```

### 2. è‡ªåŠ¨åŠ è½½

ç¬¬äºŒæ¬¡è¿è¡Œæ—¶ï¼Œä¼šè‡ªåŠ¨æ£€æŸ¥ç¼“å­˜ï¼š
- âœ… å¦‚æœç¼“å­˜å­˜åœ¨ä¸”é…ç½®åŒ¹é…ï¼Œç›´æ¥åŠ è½½ï¼ˆç§’çº§åŠ è½½ï¼‰
- âš ï¸ å¦‚æœé…ç½®ä¸åŒ¹é…ï¼ˆå¦‚lookback/pred_lenæ”¹å˜ï¼‰ï¼Œè‡ªåŠ¨é‡æ–°å¤„ç†
- ğŸ”„ å¦‚æœç¼“å­˜æŸåæˆ–ä¸å­˜åœ¨ï¼Œè‡ªåŠ¨ä¸‹è½½å¹¶å¤„ç†

### 3. é…ç½®éªŒè¯

ç¼“å­˜ä¼šéªŒè¯ä»¥ä¸‹é…ç½®æ˜¯å¦åŒ¹é…ï¼š
- `lookback`: å†å²æ•°æ®é•¿åº¦
- `pred_len`: é¢„æµ‹é•¿åº¦
- `context_length`: ä¸Šä¸‹æ–‡é•¿åº¦

åªæœ‰è¿™äº›å‚æ•°å®Œå…¨åŒ¹é…æ—¶ï¼Œæ‰ä¼šä½¿ç”¨ç¼“å­˜ã€‚

## ä½¿ç”¨æ–¹æ³•

### é»˜è®¤è¡Œä¸ºï¼ˆæ¨èï¼‰

```bash
# ç¬¬ä¸€æ¬¡è¿è¡Œï¼šä¸‹è½½+å¤„ç†+è®­ç»ƒ
python scripts/train.py --mode pretrain --data-source utsd-s3 --utsd-subset UTSD-1G

# ç¬¬äºŒæ¬¡è¿è¡Œï¼šç›´æ¥ä»ç¼“å­˜åŠ è½½ï¼ˆå¿«é€Ÿï¼ï¼‰
python scripts/train.py --mode pretrain --data-source utsd-s3 --utsd-subset UTSD-1G
```

**è¾“å‡ºç¤ºä¾‹ï¼ˆç¬¬äºŒæ¬¡è¿è¡Œï¼‰**ï¼š
```
[INFO] Cache found at data_cache, will try to use it...
[INFO] Found cached data, loading from local files...
  Cache directory: data_cache
  Loaded 123456 train sequences
  Loaded 13717 val sequences
[OK] Successfully loaded cached data!
```

### å¼ºåˆ¶é‡æ–°å¤„ç†

å¦‚æœæ‚¨ä¿®æ”¹äº†é¢„å¤„ç†ä»£ç æˆ–æƒ³é‡æ–°ä¸‹è½½æ•°æ®ï¼š

```bash
python scripts/train.py --mode pretrain --data-source utsd-s3 \
    --utsd-subset UTSD-1G --no-cache
```

## æ€§èƒ½å¯¹æ¯”

| æ“ä½œ | ç¬¬ä¸€æ¬¡è¿è¡Œ | ä½¿ç”¨ç¼“å­˜ | åŠ é€Ÿæ¯” |
|------|-----------|---------|--------|
| ä¸‹è½½æ•°æ® | ~30-60ç§’ | è·³è¿‡ | âˆ |
| å¤„ç†æ•°æ® | ~2-5åˆ†é’Ÿ | è·³è¿‡ | âˆ |
| åŠ è½½ç¼“å­˜ | - | ~5-10ç§’ | - |
| **æ€»æ—¶é—´** | **~3-6åˆ†é’Ÿ** | **~5-10ç§’** | **20-40x** |

## æŠ€æœ¯ç»†èŠ‚

### ç¼“å­˜æ–‡ä»¶å†…å®¹

1. **train_sequences.pkl**:
   - å­˜å‚¨ï¼šå·²å½’ä¸€åŒ–çš„è®­ç»ƒåºåˆ—åˆ—è¡¨
   - æ ¼å¼ï¼š`List[np.ndarray]`
   - æ¯ä¸ªåºåˆ—é•¿åº¦ï¼š`context_length`ï¼ˆå¦‚576ï¼‰

2. **val_sequences.pkl**:
   - å­˜å‚¨ï¼šå·²å½’ä¸€åŒ–çš„éªŒè¯åºåˆ—åˆ—è¡¨
   - æ ¼å¼ï¼š`List[np.ndarray]`

3. **data_config.pkl**:
   - å­˜å‚¨ï¼šæ•°æ®é…ç½®ä¿¡æ¯
   - åŒ…å«ï¼šlookback, pred_len, context_length, n_train, n_valç­‰

### ç¼“å­˜ä½ç½®

- é»˜è®¤ä½ç½®ï¼š`data_cache/`ï¼ˆåœ¨é¡¹ç›®æ ¹ç›®å½•ï¼‰
- å¯é€šè¿‡ `--data-dir` å‚æ•°ä¿®æ”¹

### ç£ç›˜ç©ºé—´

- UTSD-1Gå¤„ç†åçš„ç¼“å­˜ï¼šçº¦50-200MB
- UTSD-12Gå¤„ç†åçš„ç¼“å­˜ï¼šçº¦500MB-2GB

## æ³¨æ„äº‹é¡¹

1. **é…ç½®å˜åŒ–**ï¼šå¦‚æœä¿®æ”¹äº†lookbackã€pred_lenæˆ–context_lengthï¼Œç¼“å­˜ä¼šè‡ªåŠ¨å¤±æ•ˆå¹¶é‡æ–°å¤„ç†

2. **ä»£ç æ›´æ–°**ï¼šå¦‚æœæ‚¨ä¿®æ”¹äº†æ•°æ®é¢„å¤„ç†ä»£ç ï¼ˆs3_preprocessor.pyï¼‰ï¼Œå»ºè®®ä½¿ç”¨ `--no-cache` é‡æ–°å¤„ç†

3. **ç£ç›˜ç©ºé—´**ï¼šç¡®ä¿æœ‰è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´å­˜å‚¨ç¼“å­˜æ–‡ä»¶

4. **ç¼“å­˜æ¸…ç†**ï¼šå¦‚éœ€æ¸…ç†ç¼“å­˜ï¼Œç›´æ¥åˆ é™¤ `data_cache/` ç›®å½•ä¸­çš„ `.pkl` æ–‡ä»¶å³å¯

## å‘½ä»¤è¡Œå‚æ•°

- **é»˜è®¤è¡Œä¸º**ï¼šè‡ªåŠ¨ä½¿ç”¨ç¼“å­˜ï¼ˆæ¨èï¼‰
- `--no-cache`ï¼šå¼ºåˆ¶é‡æ–°å¤„ç†æ•°æ®ï¼Œå¿½ç•¥ç¼“å­˜
- `--data-dir <path>`ï¼šæŒ‡å®šç¼“å­˜ç›®å½•ï¼ˆé»˜è®¤ï¼šdata_cacheï¼‰

## ç¤ºä¾‹

### å¿«é€Ÿå¼€å§‹ï¼ˆä½¿ç”¨ç¼“å­˜ï¼‰
```bash
# ç¬¬ä¸€æ¬¡è¿è¡Œ
python scripts/train.py --mode pretrain --data-source utsd-s3 \
    --utsd-subset UTSD-1G --batch-size 4 --num-epochs 1 \
    --output-dir outputs/test

# ç¬¬äºŒæ¬¡è¿è¡Œï¼ˆä½¿ç”¨ç¼“å­˜ï¼Œå¿«é€Ÿå¯åŠ¨ï¼‰
python scripts/train.py --mode pretrain --data-source utsd-s3 \
    --utsd-subset UTSD-1G --batch-size 8 --num-epochs 10 \
    --output-dir outputs/full_pretrain
```

### æ›´æ–°é¢„å¤„ç†ä»£ç å
```bash
# å¼ºåˆ¶é‡æ–°å¤„ç†
python scripts/train.py --mode pretrain --data-source utsd-s3 \
    --utsd-subset UTSD-1G --no-cache
```

### ä½¿ç”¨è‡ªå®šä¹‰ç¼“å­˜ç›®å½•
```bash
python scripts/train.py --mode pretrain --data-source utsd-s3 \
    --utsd-subset UTSD-1G --data-dir /path/to/custom/cache
```

## æ€»ç»“

æœ¬åœ°ç¼“å­˜åŠŸèƒ½å¤§å¤§åŠ é€Ÿäº†è®­ç»ƒå¯åŠ¨é€Ÿåº¦ï¼Œç‰¹åˆ«é€‚åˆï¼š
- ğŸ”¬ è°ƒè¯•å’Œå®éªŒï¼šå¿«é€Ÿè¿­ä»£è¶…å‚æ•°
- ğŸ¯ å¤šæ¬¡è®­ç»ƒï¼šåœ¨åŒä¸€æ•°æ®é›†ä¸Šè¿›è¡Œå¤šæ¬¡å®éªŒ
- ğŸ“¡ ç½‘ç»œå—é™ï¼šé¿å…é‡å¤ä¸‹è½½æ•°æ®
- â±ï¸ å¿«é€ŸåŸå‹ï¼šå‡å°‘ç­‰å¾…æ—¶é—´

ç¬¬ä¸€æ¬¡è¿è¡Œæ—¶ä¼šè‡ªåŠ¨åˆ›å»ºç¼“å­˜ï¼Œä¹‹åçš„è¿è¡Œä¼šè‡ªåŠ¨ä½¿ç”¨ç¼“å­˜ï¼Œæ— éœ€ä»»ä½•é¢å¤–æ“ä½œï¼




