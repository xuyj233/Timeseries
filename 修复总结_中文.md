# Bugä¿®å¤æ€»ç»“

## é—®é¢˜

æ‚¨é‡åˆ°çš„é”™è¯¯ï¼š
```
ValueError: too many values to unpack (expected 2)
RuntimeError: maximum size for tensor at dimension 2 is 7 but size is 96
```

## æ ¹æœ¬åŸå› 

Timeræ¨¡å‹åœ¨**è®­ç»ƒ**å’Œ**è¯„ä¼°**æ—¶ä½¿ç”¨äº†ä¸åŒç»´åº¦çš„æ•°æ®ï¼š

- **è®­ç»ƒæ—¶ï¼ˆS3æ•°æ®ï¼‰**: å•å˜é‡æ—¶é—´åºåˆ— â†’ 2Då¼ é‡ `(batch, seq_len)`
- **è¯„ä¼°æ—¶ï¼ˆETTH1æ•°æ®ï¼‰**: å¤šå˜é‡æ—¶é—´åºåˆ—ï¼ˆ7ä¸ªç‰¹å¾ï¼‰â†’ 3Då¼ é‡ `(batch, seq_len, 7)`

æ¨¡å‹åŸæœ¬åªæ”¯æŒ2Dè¾“å…¥ï¼Œå¯¼è‡´å¤„ç†3Dè¾“å…¥æ—¶å‡ºé”™ã€‚

## ä¿®å¤å†…å®¹

### 1. `models/timer_model.py` - ç¬¬244è¡Œ
ä¿®å¤äº†input_idså½¢çŠ¶è§£åŒ…ï¼Œç°åœ¨æ”¯æŒ2Då’Œ3Då¼ é‡ï¼š
```python
# ä¿®å¤å‰
batch_size, seq_length = input_ids.shape  # é”™è¯¯ï¼

# ä¿®å¤å
if input_ids.ndim == 2:
    batch_size, seq_length = input_ids.shape
else:
    batch_size, seq_length = input_ids.shape[:2]
```

### 2. `models/timer_model.py` - TimerPatchEmbeddingç±»
é‡å†™äº†patch embeddingå±‚ï¼Œä½¿å…¶èƒ½å¤Ÿæ­£ç¡®å¤„ç†å¤šå˜é‡è¾“å…¥ï¼š
- **å•å˜é‡**ï¼šç›´æ¥åœ¨æ—¶é—´ç»´åº¦ä¸Šåˆ†å‰²patches
- **å¤šå˜é‡**ï¼šå…ˆè½¬ç½®ï¼Œåœ¨æ—¶é—´ç»´åº¦ä¸Šåˆ†å‰²patchesï¼Œç„¶ååœ¨ç‰¹å¾ç»´åº¦ä¸Šå¹³å‡

### 3. `scripts/evaluate.py`
- ä¹‹å‰å·²ä¿®å¤JSONåºåˆ—åŒ–é—®é¢˜ï¼ˆnumpy.float32ï¼‰
- æ”¹è¿›äº†é”™è¯¯å¤„ç†é€»è¾‘

## éªŒè¯ç»“æœ

```bash
python scripts\evaluate.py --model-path outputs\quick_test\best_model --datasets ETTH1 --batch-size 32 --output-dir outputs\final_test
```

âœ… **æˆåŠŸè¿è¡Œï¼Œæ‰€æœ‰85ä¸ªæ‰¹æ¬¡éƒ½æ­£å¸¸å¤„ç†ï¼Œæ— é”™è¯¯ï¼**

```
Test samples: 2717
  Processed 10/85 batches
  Processed 20/85 batches
  ...
  Processed 80/85 batches

ETTH1 Results:
  MSE:  1.319881
  MAE:  0.887022
  RMSE: 1.148861
  MAPE: 232.38%
  Direction Acc: 47.20%

[OK] Results saved to outputs\final_test\evaluation_results.json
```

## å…³äºæ€§èƒ½

å½“å‰æ€§èƒ½ä¸ä½³ï¼ˆMAPE=232.38%ï¼‰æ˜¯æ­£å¸¸çš„ï¼Œå› ä¸ºï¼š

1. **æ•°æ®ä¸åŒ¹é…**: æ¨¡å‹åœ¨S3å•å˜é‡æ•°æ®ä¸Šé¢„è®­ç»ƒï¼Œä½†åœ¨ETTH1å¤šå˜é‡æ•°æ®ä¸Šè¯„ä¼°
2. **éœ€è¦å¾®è°ƒ**: é¢„è®­ç»ƒæ¨¡å‹éœ€è¦åœ¨ç›®æ ‡æ•°æ®é›†ä¸Šå¾®è°ƒæ‰èƒ½è·å¾—å¥½çš„æ€§èƒ½
3. **ç®€åŒ–çš„å¤šå˜é‡å¤„ç†**: å½“å‰åœ¨ç‰¹å¾ç»´åº¦ä¸Šç®€å•å¹³å‡ï¼Œå¯ä»¥æ”¹è¿›

## ä¸‹ä¸€æ­¥å»ºè®®

1. **å¾®è°ƒæ¨¡å‹**: åœ¨ETTH1ç­‰æ ‡å‡†æ•°æ®é›†ä¸Šå¾®è°ƒé¢„è®­ç»ƒæ¨¡å‹
2. **æ”¹è¿›å¤šå˜é‡å¤„ç†**: ä½¿ç”¨æ›´å¤æ‚çš„ç‰¹å¾èåˆç­–ç•¥ï¼ˆå¦‚æ³¨æ„åŠ›æœºåˆ¶ï¼‰
3. **æˆ–è€…ä¿æŒå•å˜é‡**: åœ¨è¯„ä¼°æ—¶ä¹Ÿä½¿ç”¨å•å˜é‡æ•°æ®ï¼ˆæ¯ä¸ªç‰¹å¾ç‹¬ç«‹è¯„ä¼°ï¼‰

## ä¿®æ”¹çš„æ–‡ä»¶

1. âœ… `models/timer_model.py` - ä¿®å¤ç»´åº¦é—®é¢˜å’Œpatch embedding
2. âœ… `scripts/evaluate.py` - JSONåºåˆ—åŒ–å’Œé”™è¯¯å¤„ç†

æ‰€æœ‰æ ¸å¿ƒbugå·²ä¿®å¤ï¼Œè¯„ä¼°è„šæœ¬ç°åœ¨å¯ä»¥æ­£å¸¸è¿è¡Œï¼ğŸ‰




